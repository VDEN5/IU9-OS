# Гайд на лабораторную работу номер 1 (2025)

## Введение

Для начала нужен любой комп, кроме Mac. Затем должно быть достаточное место на диске, чтобы установить все программы и создать виртуальные диски.

## ReactOS

### Установка RosBE
Тут в приницпе ничего сложного нет [качаете этот RosBE](https://reactos.org/wiki/Build_Environment). На винде проблем с установкой быть не должно. На линуксе требуется установить некоторые дополнителнения, но всё делается просто через консоль. Есть только небольшая проблема с установкой питона (обычного, не 3), у вас скорее всего есть python3, поэтому можно (пусть и не желательно в целом) сделать так:
```bash
sudo apt install python-is-python3
```
Дальше указывайте директорию, куда клонируете [репозиторий](https://github.com/reactos/reactos). Переходим уже в терминал скачанного RosBE. Все комманды далее выполнять нужно именно в нем

### Сбока ReactOS
нужно поочередно выполнить команды:
```bash
git clone https://github.com/reactos/reactos
```
```bash
cd reactos
```
После клонирования и перехода к исходникам нужно не забыть про свое основное задание: не забыть "занести в ReactOS свою часть", ну то есть фамилию и имя, поэтому теперь ищем в клонированных исходниках файл `ntoskrnl/kd64/kdinit.c` там пишем рядом с другими функциями `DPRINT1` следующую строчку (поставить нужно свое имя и свою фамилию):
```C
DPRINT1("Ivan Ivanov\n");
```
Теперь после сохранения измененного файла возвращаемся к сборке.
Конфигурация: если винда
```bash
configure.cmd
```
если линукс
```bash
configure.sh
```
Дальше всё стандартно для винды и убунту:
```bash
cd output-MinGW-i386
```
```bash
ninja bootcd
```
Но в конфигурации и в последнем пункте может произойти веселье))). Тогда проблема скорее всего в основном компиляторе C на вашей ОС. Поэтому рекомендовал бы сменить ОС (например, у меня и не только не работал последний пункт на винде, после перехода на линукс всё запустилось с первой попытки). Скорее всего любые попытки запуска различных алгоритмов сборки согласно [документации](https://reactos.org/wiki/Building_ReactOS) будут тщетны. Главный результат этого этапа-наличие файла `bootcd.iso`.

### Запуск виртуальной машины

Теперь на последней версии VirtualBox под вашу ОС создаем виртуальную машину со следующими настройками:
1. Имя-ReactOS
2. Тип-Windows-2003(32 bit)
3. Подключаем собранный iso-образ
4. В `COM` - портах находим включаем порт 1, номер порта `COM1`, а режим-перенаправление в файл, далее нужно указать путь к созданному пустому файлу `.log`

Все остальные пункты я оставил по умолчанию, то есть просто протыкал. Важно использовать именно последнюю версию VirtualBox, так как поддерживаются последние, вот [этому](https://reactos.org/wiki/VirtualBox) крайне не рекомендуется доверять, он рекомендует старые версии. После всех манипуляций уже запускаете (стартуете) машину. Как только предлагает выбор языка, смотрите файл с логами, он уже должен быть заполнен. В случае появления логов можно спокойно выключать машину, первую часть лабораторной уже успешно выполнили.

## NetBSD

### Первый запуск виртуальной машины
Всюду далее я полагаю, что первая часть лабораторной работы выполнена, то есть VirtualBox работает полностью. Для начала качаем [образ](https://ftp.netbsd.org/pub/NetBSD/iso/). После так же создаем машину, имя даете NetBSD и вставляем образ, ставим так же COM1 и файл с логами. Но нужно будет создать еще сетевой мост:Сеть->Адаптер 1->Тип подключения: сетевой мост. Теперь начинаем первый запуск, будет настройка. Настравивайте сами, в инете посмотрите как это делать, но в целом ничего сложного. После установки (внутри машины будет написано, что она кончилась и нужно тыкнуть по кнопке) убираем образ и по-новой без него запускаем

### Установка исходников

Заходим под рутом. Открываем файл `/etc/syslog.conf`, используя vim
```bash
vi /etc/syslog.conf
```
Чтобы можно было писать, жмем I. Пишем строку: `kern.* /dev/tty00`. Жмем esc, пишем :wq и enter в конце.
Теперь нужно проверить интернет, например запинговать сайт какой-то. Если его нет-качаем по-новой, нужно, чтобы был интернет. В случае присутствия интернета качаем исходники согласно [документации](https://www.netbsd.org/docs/guide/en/chap-fetch.html#chap-fetch-cvs):
```bash
export CVSROOT="anoncvs@anoncvs.NetBSD.org:/cvsroot"
```
```bash
export CVS_RSH="ssh"
```
```bash
cd /usr
```
```bash
cvs checkout -r netbsd-10-0-RELEASE -P src
```
Замечание: `netbsd-10-0` заменить на свою версию
### Вставляем свою фамилию в исходники

Меняем через vim `/usr/src/sys/kern/init_main.c`.
Вставляем в самый конец (Esc + shift + G) на строчку выше печатанию (через (*pr)) информации о ОС (память и т. д.), строчку (замените на свои данные):
```C
(*pr)("\n%s\n", "Ivan Ivanov");
```
Сохраняем и переходим к сборке, выполняя следующие команды:
```bash
cd /usr/src/sys/arch/amd64/conf 
```
```bash
cp GENERIC MYKERN && config MYKERN
```
```bash
cd ../compile/MYKERN && make depend && make 
```
```bash
mv /netbsd /netbsd.old && mv netbsd /
```
После этого в файле логов должна появиться ваша фамилия и ваше имя.